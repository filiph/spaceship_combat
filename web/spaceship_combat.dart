library spaceship_combat;

import "dart:async";
import "dart:math" as Math;
import "package:vector_math/vector_math.dart";
import "package:darwin/darwin.dart";
import "package:backy/backy.dart";
import "package:box2d/box2d_browser.dart";
import "dart:html";

import "box2d_demo.dart";

part "shipbrain.dart";

PreElement experimentStatusEl;
PreElement globalStatusEl;

ShipCombatSituation currentSituation;

void main() {
  experimentStatusEl = querySelector("#experiment-status");
  globalStatusEl = querySelector("#global-status");
  
  querySelector("#speed1x").onClick.listen((_) => 
      Demo.computationToShowRatio = 1);
  querySelector("#speed10x").onClick.listen((_) => 
      Demo.computationToShowRatio = 10);
  querySelector("#speed100x").onClick.listen((_) => 
      Demo.computationToShowRatio = 100);
  querySelector("#speed1000x").onClick.listen((_) => 
      Demo.computationToShowRatio = 1000);
  
  querySelector("#putOnNoseTrain").onClick.listen((_) => 
      startGeneticAlgorithm(new PutOnNoseMode()));
  querySelector("#ramTrain").onClick.listen((_) => 
      startGeneticAlgorithm(new RamMode()));
  querySelector("#runAwayTrain").onClick.listen((_) => 
      startGeneticAlgorithm(new RunAwayMode()));
  
  querySelector("#putOnNoseBest").onClick.listen((_) => 
      loopBestPhenotype(new PutOnNoseMode()));
  querySelector("#ramBest").onClick.listen((_) => 
      loopBestPhenotype(new RamMode()));
  querySelector("#runAwayBest").onClick.listen((_) => 
      loopBestPhenotype(new RunAwayMode()));
  
  startGeneticAlgorithm(new PutOnNoseMode());
}

/**
 * Just show off the best phenotype for the [ShipBrainMode].
 */
void loopBestPhenotype(ShipBrainMode modeToTest, [int i = 0]) {
  if (currentSituation != null) currentSituation.destroy();
  
  globalStatusEl.text = "Showing best for $modeToTest";
  
  print("Experiment $i");
  if (i >= modeToTest.setupFunctions.length) {
    new Future(() => loopBestPhenotype(modeToTest, 0));  // restart
    return;
  }
  
  ShipCombatSituation s = new ShipCombatSituation(
      fitnessFunction: modeToTest.iterativeFitnessFunction);
  currentSituation = s;
  var bodega = NeuroPilotSerialEvaluator._createBodega(s);
  var messenger = NeuroPilotSerialEvaluator._createMessenger(s);
  s.addShip(bodega, evaluatedShip: true);
  s.addShip(messenger);
  bodega.target = messenger;
  bodega.brainMode = modeToTest;
  bodega.brainMode.initializeBrain(bodega);
  bodega.brainMode.setBrainFromPhenotype(modeToTest.bestPhenotype);
  bodega.brainMode.setupFunctions[i](s);
  s.runTest().then((ShipCombatSituation s) {
    s.destroy();
    currentSituation = null;
    loopBestPhenotype(modeToTest, i + 1);
  });
}

/**
 * Start the algorithm.
 */
void startGeneticAlgorithm(ShipBrainMode modeToTest) {
  if (currentSituation != null) currentSituation.destroy();
  
  int firstGenerationSize = 20;
  var firstGeneration = new Generation<NeuroPilotPhenotype>();
  
  List chromosomesList;
  
//chromosomesList = [
//[0.656042246016904,-1,-0.24081318444856392,0.5744812279030207,0.2294102058580787,1,0.3035244461389026,-1,-1,0.9788210371967068,-1,-0.30394320371064953,0.541511346181798,-0.4919182529775268,0.06441859930483651,1,-0.8866056556621515,-0.1523101906619717,1,-0.5333387891790473,-1,0.2114781396876071,-1,0.47062753360648335,0.37469768444830565,-1,-1,0.7553430133047478,-1,0.8036223092026535,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,1,0.7246010776546117,0.6380770183191189,1,1,1,0.8834377090394323,-1,0.9034351422933586,1,0.7532839617435458,1,0.9569661327238526,-1,-1,-1,-1,-1,-1,-0.13176506082818373,0.45506549060346924,-0.039621954389641445,-0.4293651779480425,-0.6297581134691022,0.005330164394882431,1,-0.3925779880446416,-0.8135402410935644,0.5133826377775486,-1,-0.7147878509754113,-1,0.08415824234521363,1,0.7789551787282964,1,-1,1,-1,-1,-1,-1,0.6940740089925037,-0.8860931172536737],
//[1,-1,-0.24081318444856392,0.5744812279030207,0.2294102058580787,1,0.3035244461389026,-1,-1,0.9788210371967068,-1,-0.30394320371064953,1,-0.65725713290285,0.06441859930483651,1,-0.8866056556621515,-0.1523101906619717,1,-0.5333387891790473,-1,0.2114781396876071,-0.9216289836952081,0.47062753360648335,0.37469768444830565,-1,-1,0.3153966366056331,-1,0.3936570980602092,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,1,0.7246010776546117,0.6380770183191189,1,1,1,0.8834377090394323,-0.8754321529101186,0.9034351422933586,1,0.7532839617435458,1,0.9569661327238526,-1,-1,-1,-1,0.6587097038459484,-0.5611031364488495,-0.3660292371754801,0.45506549060346924,-0.039621954389641445,-0.4293651779480425,-0.6297581134691022,0.005330164394882431,1,-0.3925779880446416,-0.8135402410935644,0.5133826377775486,-0.3347945708169964,-1,-1,0.08415824234521363,1,0.7789551787282964,1,-1,1,-1,-1,-1,-1,0.6940740089925037,-0.8860931172536737],
//[0.656042246016904,-1,-0.24081318444856392,0.5744812279030207,-0.7195115405978962,1,0.3035244461389026,-1,-0.6065711605533946,0.9788210371967068,-1,0.4729139858876745,0.541511346181798,-0.65725713290285,-1,1,-0.8866056556621515,-0.1523101906619717,1,-0.5333387891790473,-0.10354538923425571,0.864497278944877,-1,0.47062753360648335,-0.13150060621124782,-1,-1,0.7553430133047478,-1,0.3936570980602092,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,1,0.7246010776546117,0.6380770183191189,1,1,1,1,-0.8754321529101186,0.9034351422933586,1,0.7532839617435458,0.8280652996809661,0.9569661327238526,-1,-1,-1,-1,-0.24725117381601835,-1,-1,0.45506549060346924,-0.039621954389641445,-0.4293651779480425,-0.6297581134691022,0.005330164394882431,1,-0.3925779880446416,-0.8731240899732828,-0.39315162530495673,-1,-0.7147878509754113,-0.9726085102700306,0.08415824234521363,1,0.7789551787282964,1,-1,1,-1,-1,-1,-1,0.6940740089925037,-0.8860931172536737],
//[0.656042246016904,-1,-0.24081318444856392,0.5744812279030207,0.2294102058580787,1,0.3035244461389026,-1,-1,0.9788210371967068,-1,-0.30394320371064953,1,-0.4919182529775268,0.06441859930483651,1,-0.8866056556621515,-0.1523101906619717,1,-0.5333387891790473,-1,0.2114781396876071,-1,0.47062753360648335,0.37469768444830565,-1,-1,0.7553430133047478,-1,0.8036223092026535,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,0.2011619382456611,0.7246010776546117,0.6380770183191189,0.7904829313094861,1,1,0.8834377090394323,-0.8754321529101186,0.9804497013569788,1,0.7532839617435458,1,0.9569661327238526,-1,-1,-1,-1,-1,-1,-1,0.45506549060346924,-0.039621954389641445,-0.4293651779480425,-0.6297581134691022,0.005330164394882431,1,-0.3925779880446416,-0.8135402410935644,0.5133826377775486,-1,-0.7147878509754113,-0.9726085102700306,0.08415824234521363,1,1,1,-1,1,-1,-1,-1,-1,0.9498462671180838,-0.8860931172536737],
//[1,-1,-0.24081318444856392,0.5744812279030207,0.2294102058580787,1,0.3035244461389026,-1,-1,0.9788210371967068,-1,0.4729139858876745,0.541511346181798,-0.4919182529775268,-1,1,-0.8866056556621515,-0.1523101906619717,1,-0.5333387891790473,-1,0.2114781396876071,-1,0.47062753360648335,0.37469768444830565,-1,-1,0.06348132417499319,-1,0.8036223092026535,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,1,0.7246010776546117,0.6380770183191189,1,1,1,0.8834377090394323,-0.8754321529101186,0.9034351422933586,1,0.7532839617435458,1,0.9569661327238526,-1,-1,-1,-1,-1,-1,-1,0.45506549060346924,-0.039621954389641445,-0.4293651779480425,-0.6297581134691022,0.005330164394882431,1,-0.3925779880446416,-0.8731240899732828,0.5133826377775486,-1,-1,-0.9726085102700306,0.08415824234521363,1,1,1,-1,1,-1,-1,-1,-1,0.6940740089925037,-0.8860931172536737],
//[1,-1,-0.24081318444856392,0.5744812279030207,0.2294102058580787,1,0.3035244461389026,-1,-1,0.9788210371967068,-1,0.4729139858876745,0.541511346181798,-0.4919182529775268,0.06441859930483651,1,-0.8866056556621515,-0.1523101906619717,1,-0.5333387891790473,-0.10354538923425571,0.864497278944877,-1,0.47062753360648335,0.37469768444830565,-1,-1,0.7553430133047478,-1,0.3936570980602092,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,1,0.7246010776546117,0.6380770183191189,0.9832376096636166,1,1,0.8834377090394323,-0.8754321529101186,0.9034351422933586,1,1,1,0.9569661327238526,-1,-1,-1,-1,-0.24725117381601835,-1,-0.3660292371754801,0.45506549060346924,-0.039621954389641445,-0.4293651779480425,-0.6297581134691022,0.005330164394882431,1,-0.3925779880446416,-0.008346568529159937,0.5133826377775486,-1,-1,-0.9726085102700306,0.08415824234521363,1,1,0.16605023463709978,-1,1,-1,-1,-1,-1,0.8652467494936729,-0.8860931172536737],
//[1,-1,-0.24081318444856392,0.5744812279030207,0.2294102058580787,1,0.3035244461389026,-1,-1,0.9788210371967068,-1,-0.30394320371064953,1,-0.65725713290285,-1,1,-0.8866056556621515,-0.8523225194769692,1,-0.5333387891790473,-1,0.864497278944877,-1,-0.277910830828376,-0.13150060621124782,-1,-1,0.06348132417499319,-1,0.8036223092026535,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,1,0.7246010776546117,0.6380770183191189,1,1,1,1,-0.8754321529101186,0.9804497013569788,1,0.7532839617435458,1,0.9569661327238526,-1,-1,-1,-1,-1,-1,-1,0.45506549060346924,-0.039621954389641445,-0.4293651779480425,-0.6297581134691022,0.005330164394882431,1,-0.3925779880446416,-0.78988098930732,-0.1168442454317895,-0.3347945708169964,-0.7147878509754113,-1,0.08415824234521363,1,0.7789551787282964,1,-1,1,-1,-1,-1,-1,0.6940740089925037,-0.8860931172536737],
//[1,-1,-0.7700196717181915,0.5744812279030207,0.2294102058580787,1,0.3035244461389026,-1,-1,0.5066924590542783,-1,0.4729139858876745,1,-0.65725713290285,0.06441859930483651,0.6979449153249508,-0.8866056556621515,-0.1523101906619717,1,-0.5333387891790473,-1,0.2114781396876071,-0.9216289836952081,0.47062753360648335,0.37469768444830565,-1,-1,0.7553430133047478,-1,0.3936570980602092,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,1,0.7246010776546117,0.6380770183191189,0.9832376096636166,1,1,0.8834377090394323,-1,0.9804497013569788,1,0.7532839617435458,1,0.9569661327238526,-1,-0.8942846366337476,-1,-1,-0.24725117381601835,-1,-0.13176506082818373,0.45506549060346924,-0.039621954389641445,-0.4293651779480425,-0.6297581134691022,-0.979022266626985,1,-0.3925779880446416,-0.8731240899732828,0.5133826377775486,-0.3347945708169964,-0.7147878509754113,-0.9726085102700306,0.08415824234521363,1,0.7789551787282964,0.16605023463709978,-1,1,-1,-1,-1,-1,0.8652467494936729,-0.8860931172536737],
//[1,-1,-0.24081318444856392,0.5744812279030207,0.2294102058580787,1,0.3035244461389026,-1,-1,0.5066924590542783,-1,0.4729139858876745,0.541511346181798,-0.4919182529775268,-1,1,-0.8866056556621515,-0.1523101906619717,1,-0.5333387891790473,-1,0.8160589849826112,-1,0.47062753360648335,0.37469768444830565,-1,-1,0.7553430133047478,-1,0.8036223092026535,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,1,0.7246010776546117,0.6380770183191189,0.9832376096636166,1,1,0.8834377090394323,-0.8754321529101186,0.9804497013569788,1,0.7532839617435458,1,0.9569661327238526,-1,-1,-1,-1,-0.24725117381601835,-1,-1,0.45506549060346924,-0.039621954389641445,-0.4293651779480425,-0.6297581134691022,0.005330164394882431,1,-0.3925779880446416,-0.8731240899732828,0.5133826377775486,-0.3347945708169964,-0.44493613271947874,-1,0.08415824234521363,0.29851415279071425,1,1,-1,1,-1,-1,-1,-1,0.6940740089925037,-0.8860931172536737],
//[1,-1,-0.24081318444856392,0.5744812279030207,0.2294102058580787,1,0.3035244461389026,-1,-1,0.9788210371967068,-1,-0.30394320371064953,0.541511346181798,-0.65725713290285,-1,1,-0.8866056556621515,-0.1523101906619717,1,-0.5333387891790473,-0.10354538923425571,0.864497278944877,-1,0.47062753360648335,-0.13150060621124782,-1,-1,0.7553430133047478,-1,0.8036223092026535,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,1,0.7246010776546117,0.6380770183191189,0.9832376096636166,1,1,0.8834377090394323,-0.8754321529101186,0.9804497013569788,1,1,1,0.9569661327238526,-1,-1,-1,-1,-1,-1,-1,0.45506549060346924,-0.039621954389641445,-0.4293651779480425,-0.6297581134691022,0.005330164394882431,1,-0.3925779880446416,-0.8731240899732828,0.5133826377775486,-1,-1,-0.9726085102700306,0.08415824234521363,1,0.7789551787282964,0.16605023463709978,-1,1,-1,-1,-1,-1,0.8652467494936729,-0.8860931172536737],
//[1,-1,-0.24081318444856392,0.5744812279030207,0.2294102058580787,1,0.3035244461389026,-1,-1,0.9788210371967068,-1,0.4729139858876745,1,-0.4919182529775268,0.06441859930483651,1,-0.8866056556621515,-0.1523101906619717,1,-0.5333387891790473,-1,0.864497278944877,-1,0.47062753360648335,0.37469768444830565,-1,-1,0.06348132417499319,-1,0.3936570980602092,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,1,0.7246010776546117,0.6380770183191189,1,1,1,1,-0.8754321529101186,0.9034351422933586,1,0.7532839617435458,1,0.9569661327238526,-1,-1,-1,-1,-0.24725117381601835,-1,-0.3660292371754801,0.45506549060346924,-0.039621954389641445,-0.4293651779480425,-0.6297581134691022,0.005330164394882431,1,-0.3925779880446416,-0.78988098930732,0.5133826377775486,-0.3347945708169964,-0.7147878509754113,-1,0.08415824234521363,1,1,1,-1,1,-1,-1,-1,-1,0.6940740089925037,-0.8860931172536737],
//[0.656042246016904,-1,-0.24081318444856392,0.5744812279030207,0.2294102058580787,1,0.3035244461389026,-1,-1,0.9788210371967068,-1,-0.30394320371064953,1,-0.4919182529775268,0.06441859930483651,1,-0.8866056556621515,-0.1523101906619717,1,-0.5333387891790473,-1,0.864497278944877,-1,0.47062753360648335,-0.13150060621124782,-1,-1,0.7553430133047478,-1,0.8036223092026535,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,1,0.7246010776546117,0.6380770183191189,1,1,1,0.8834377090394323,-0.8754321529101186,0.9804497013569788,1,0.7532839617435458,1,0.9569661327238526,-1,-1,-1,-1,-1,-1,-0.3660292371754801,0.45506549060346924,-0.039621954389641445,-0.4293651779480425,-0.6297581134691022,0.005330164394882431,1,-0.3925779880446416,-0.8731240899732828,0.5133826377775486,-0.3347945708169964,-0.7147878509754113,-0.9726085102700306,0.08415824234521363,1,1,1,-1,1,-1,-1,-1,-1,0.6940740089925037,-0.8860931172536737],
//[1,-1,-0.24081318444856392,0.5744812279030207,0.2294102058580787,1,0.3035244461389026,-1,-1,0.9788210371967068,-1,0.4729139858876745,1,-0.65725713290285,-1,1,-0.8866056556621515,-0.1523101906619717,1,-0.7865191355328807,-1,0.2114781396876071,-1,0.47062753360648335,0.37469768444830565,-1,-1,0.7553430133047478,-1,0.3936570980602092,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,1,0.7246010776546117,0.6380770183191189,1,1,1,1,-0.8754321529101186,0.9034351422933586,1,0.7532839617435458,1,0.9569661327238526,-1,-1,-1,-1,-0.24725117381601835,-1,-1,0.45506549060346924,-0.039621954389641445,-0.4293651779480425,-0.6297581134691022,0.005330164394882431,1,-0.3925779880446416,-0.8731240899732828,0.5133826377775486,-1,-1,-0.7919034242620708,0.08415824234521363,1,0.7789551787282964,1,-1,1,-1,-1,-1,-1,0.6940740089925037,-0.8860931172536737],
//[1,-1,-0.24081318444856392,0.5744812279030207,0.2294102058580787,1,0.3035244461389026,-1,-1,0.5066924590542783,-1,-0.30394320371064953,0.541511346181798,-0.4919182529775268,0.06441859930483651,0.6979449153249508,-0.8866056556621515,-0.1523101906619717,1,-0.5333387891790473,-0.10354538923425571,0.8160589849826112,-1,0.47062753360648335,-0.13150060621124782,-1,-1,0.06348132417499319,-0.3537152461532722,0.8036223092026535,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,1,0.7246010776546117,0.6380770183191189,0.9832376096636166,1,1,0.8834377090394323,-0.8754321529101186,0.9034351422933586,1,0.7532839617435458,1,0.9569661327238526,-1,-0.8942846366337476,-1,-1,-1,-0.5611031364488495,-0.3660292371754801,0.45506549060346924,-0.039621954389641445,-0.4293651779480425,-0.7380715932174475,0.005330164394882431,1,-0.3925779880446416,-0.8731240899732828,-0.39315162530495673,-1,-0.7147878509754113,-0.9726085102700306,-0.1441293552639238,1,1,1,-1,1,-1,-1,-1,-1,0.6940740089925037,-0.8860931172536737],
//[1,-1,-0.24081318444856392,0.5744812279030207,0.2294102058580787,1,0.3035244461389026,-1,-1,0.9788210371967068,-1,0.4729139858876745,0.541511346181798,-0.4919182529775268,-1,1,-0.8866056556621515,-0.1523101906619717,1,-0.5333387891790473,-1,0.2114781396876071,-1,0.47062753360648335,0.37469768444830565,-1,-1,0.06348132417499319,-1,0.8036223092026535,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,1,0.7246010776546117,0.6380770183191189,0.7904829313094861,1,1,0.8834377090394323,-0.8754321529101186,0.9034351422933586,1,0.7532839617435458,1,0.9569661327238526,-1,-1,-1,-1,-1,-1,-1,0.45506549060346924,-0.039621954389641445,-0.35205790441081164,-0.6297581134691022,0.005330164394882431,1,-0.3925779880446416,-0.8135402410935644,0.5133826377775486,-1,-1,-0.9726085102700306,0.08415824234521363,1,1,1,-1,1,-1,-1,-1,-1,0.9498462671180838,-0.8860931172536737],
//[0.656042246016904,-1,-0.24081318444856392,0.5744812279030207,0.2294102058580787,1,0.3035244461389026,-1,-1,0.9788210371967068,-1,-0.30394320371064953,1,-0.4919182529775268,-0.37006445536450006,1,-0.8866056556621515,-0.1523101906619717,1,-0.5333387891790473,-1,0.2114781396876071,-1,0.47062753360648335,0.37469768444830565,-1,-1,0.7553430133047478,-1,0.8036223092026535,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,1,0.7246010776546117,0.6380770183191189,1,1,1,0.8834377090394323,-0.8754321529101186,0.9804497013569788,1,0.7532839617435458,1,0.9569661327238526,-1,-0.8942846366337476,-1,-1,-1,-1,-1,0.45506549060346924,-0.039621954389641445,-0.4293651779480425,-0.6297581134691022,0.005330164394882431,1,-0.3925779880446416,-0.8731240899732828,0.5133826377775486,-1,-0.7147878509754113,-1,0.08415824234521363,1,0.7789551787282964,1,-1,1,-1,-1,-1,-1,0.6694243114660696,-0.8860931172536737],
//[0.656042246016904,-1,-0.24081318444856392,0.5744812279030207,0.2294102058580787,1,0.3035244461389026,-1,-1,0.9788210371967068,-1,-0.30394320371064953,0.541511346181798,-0.4919182529775268,0.06441859930483651,1,-0.8866056556621515,-0.1523101906619717,1,-0.5333387891790473,-1,0.2114781396876071,-1,0.47062753360648335,0.37469768444830565,-1,-1,0.7553430133047478,-1,1,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,1,0.7246010776546117,0.6380770183191189,0.9832376096636166,1,1,0.8834377090394323,-0.8754321529101186,0.9034351422933586,1,0.7532839617435458,1,0.9569661327238526,-1,-1,-1,-1,-1,-1,-1,0.45506549060346924,-0.039621954389641445,-0.4293651779480425,-0.6297581134691022,0.005330164394882431,1,-0.3925779880446416,-0.8731240899732828,0.5133826377775486,-1,-0.7147878509754113,-0.9726085102700306,0.08415824234521363,1,1,1,-1,1,-1,-1,-1,-1,0.6940740089925037,-0.8860931172536737],
//[1,-1,-0.24081318444856392,0.5744812279030207,0.2294102058580787,1,0.3035244461389026,-1,-1,0.5066924590542783,-1,0.4729139858876745,0.541511346181798,-0.4919182529775268,0.06441859930483651,1,-0.8866056556621515,-0.1523101906619717,1,-0.5333387891790473,-1,0.2114781396876071,-1,0.47062753360648335,0.37469768444830565,-1,-1,0.7553430133047478,-1,0.8036223092026535,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,1,0.7246010776546117,0.6380770183191189,0.9832376096636166,1,1,0.8834377090394323,-1,0.9804497013569788,1,0.7532839617435458,1,0.9569661327238526,-1,-1,-1,-1,-0.24725117381601835,-1,-0.13176506082818373,0.45506549060346924,-0.039621954389641445,-0.4293651779480425,-0.6297581134691022,-0.979022266626985,1,-0.3925779880446416,-0.8731240899732828,0.5133826377775486,-0.3347945708169964,-0.44493613271947874,-1,0.08415824234521363,0.29851415279071425,0.7789551787282964,0.16605023463709978,-1,1,-1,-1,-1,-1,0.8652467494936729,-0.8860931172536737],
//[1,-1,-0.24081318444856392,0.5744812279030207,0.2294102058580787,1,0.3035244461389026,-1,-1,0.9788210371967068,-1,0.4729139858876745,1,-0.65725713290285,-1,1,-0.8866056556621515,-0.6747100617654358,1,-0.5333387891790473,-1,0.864497278944877,-1,0.47062753360648335,-0.0627640380482537,-1,-1,0.7553430133047478,-1,0.3936570980602092,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,1,0.7246010776546117,0.6380770183191189,1,1,1,1,-0.8754321529101186,0.9034351422933586,1,0.7532839617435458,1,0.9569661327238526,-1,-1,-1,-1,-0.24725117381601835,-1,-0.3660292371754801,0.45506549060346924,-0.039621954389641445,-0.4708800645739575,-0.6297581134691022,0.005330164394882431,1,-0.3925779880446416,-0.8731240899732828,0.5133826377775486,-0.3347945708169964,-1,-0.9726085102700306,0.08415824234521363,1,0.7789551787282964,1,-1,1,-1,-1,-1,-0.39428225190058974,0.6940740089925037,-0.8860931172536737],
//[0.656042246016904,-1,-0.24081318444856392,0.5744812279030207,0.2294102058580787,1,0.3035244461389026,-1,-1,0.5066924590542783,-1,-0.30394320371064953,0.541511346181798,-0.4919182529775268,0.06441859930483651,0.6979449153249508,-0.8866056556621515,-0.1523101906619717,1,-0.5333387891790473,-0.10354538923425571,0.2114781396876071,-1,0.47062753360648335,-0.13150060621124782,-1,-1,0.7553430133047478,-1,0.8036223092026535,0.46107153121756195,0.5584411618106389,0.5880153611491499,-1,1,0.7246010776546117,0.6380770183191189,1,1,1,0.8834377090394323,-0.8754321529101186,0.9034351422933586,1,0.7532839617435458,1,0.9569661327238526,-1,-0.8942846366337476,-1,-1,-1,-0.5611031364488495,-0.13176506082818373,0.45506549060346924,-0.039621954389641445,-0.4293651779480425,-0.7380715932174475,0.005330164394882431,1,-0.3925779880446416,-0.8135402410935644,0.5133826377775486,-1,-0.7147878509754113,-1,-0.1441293552639238,1,0.7789551787282964,1,-1,1,-1,-1,-1,-1,0.6940740089925037,-0.8860931172536737]
//];
  
  var breeder = new GenerationBreeder<NeuroPilotPhenotype>(
      () => new NeuroPilotPhenotype())
    ..crossoverPropability = 0.8;
  var evaluator = new NeuroPilotSerialEvaluator(modeToTest);
  
  if (chromosomesList == null) {
    AIBox2DShip tempShip = 
        NeuroPilotSerialEvaluator._createBodega(new ShipCombatSituation());
    tempShip.target = tempShip;
    for (int i = 0; i < firstGenerationSize; i++) {
      modeToTest.initializeBrain(tempShip);
      firstGeneration.members.add(
          new NeuroPilotPhenotype.fromBackyWeights(modeToTest.brain.weights));
    }
  } else {
    chromosomesList.forEach((List<num> ch) {
      NeuroPilotPhenotype ph = new NeuroPilotPhenotype();
      ph.genes = ch;
      firstGeneration.members.add(ph);
    });
  }
  
  var algo = new GeneticAlgorithm(firstGeneration, evaluator, breeder,
      statusf: (status) => globalStatusEl.text = status.toString());
  algo.runUntilDone()
  .then((_) {
    algo.generations.last.members
      .forEach((Phenotype ph) => print("${ph.genesAsString},"));
  });
}
